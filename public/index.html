<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="manifest" href="/manifest.webmanifest">
  <title>Netlify + Redis Push Starter</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; line-height: 1.5; }
    code { background: #f4f4f4; padding: 0 4px; border-radius: 4px; }
    .log { background: #111; color: #e6e6e6; padding: 1rem; border-radius: 8px; height: 220px; overflow: auto; }
    button { padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Push API Example</h1>
  <!-- <p>This is a minimal starter that registers a Service Worker, subscribes to Web Push, and stores the subscription in Redis Cloud via Netlify Functions.</p> -->

  <button id="installBtn" hidden>Install app</button>
  <script type="module" src="/install.js"></script>



  <button id="subscribeOnceBtn">Run periodic MSAK tests for 1 Hour</button>

  <br><br>


  <section style="margin-top:1rem;">
  <h2>Debug</h2>
  <div><strong>Active subscription (local):</strong> <span id="dbg-active-local">—</span></div>
  <div><strong>Active subscription (server):</strong> <span id="dbg-active-server">—</span></div>
  <div><strong>Subscription ID:</strong> <span id="dbg-sub-id">—</span></div>
  <div><strong>Tests run (this 1-hour session):</strong> <span id="dbg-run-count">0</span></div>
  <div><strong>Expires at:</strong> <span id="dbg-expires-at">—</span></div>
  <div><strong>Countdown:</strong> <span id="dbg-countdown">—</span></div>
</section>


<!-- 
  <button id="subscribeBtn">Subscribe to Push (indefinitely)</button>

  <br><br>


  <button id="subscribeTemp4hBtn">Subscribe for 4 hours</button>

  <br><br> -->


  <button id="unsubscribeBtn">Unsubscribe</button>

  <br><br>

  <button id="runTestBtn">Run Manual Test</button>

   <p>Status: <span id="status">idle</span></p>

  <h3>Log</h3>
  <pre class="log" id="log"></pre>

  <h3>Last Result</h3>
  <pre id="resultDisplay" style="background: #f8f8f8; padding: 1rem; border-radius: 8px;"></pre>



  <!-- <h3>Last Result</h3>
  <pre id="resultDisplay" style="background: #f8f8f8; padding: 1rem; border-radius: 8px;"></pre> -->


   <!-- ✅ Load msak-js first -->
  <!-- <script src="https://unpkg.com/@m-lab/msak@0.3.1/dist/msak.js"></script> -->

  <!-- <script src="/msak.js"></script> -->
  <script src="https://unpkg.com/@m-lab/msak@0.3.1/dist/msak.js"></script>


  <script src="/app.js"></script>
</body>
</html>
